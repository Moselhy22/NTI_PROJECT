{% extends "base.html" %}
{% block content %}

<h2>ğŸ›’ {{ 'Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚ Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ' if session.get('lang') == 'ar' else 'Your Shopping Cart' }}</h2>
<div id="cart-items">{{ 'Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...' if session.get('lang') == 'ar' else 'Loading...' }}</div>
<div id="cart-total" style="margin-top:20px; font-size:1.2em; font-weight:bold;"></div>
<button id="checkout-btn" style="margin-top:20px; display:none;">ğŸ’³ {{ 'Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ø¯ÙØ¹' if session.get('lang') == 'ar' else 'Proceed to Checkout' }}</button>

<script>
function updateCart() {
    const cart = JSON.parse(localStorage.getItem('healthband-cart') || '[]');
    const itemsDiv = document.getElementById('cart-items');
    const totalDiv = document.getElementById('cart-total');
    const checkoutBtn = document.getElementById('checkout-btn');

    if (cart.length === 0) {
        itemsDiv.innerHTML = `<p>${`{{ 'Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚ ÙØ§Ø±ØºØ©. ' if session.get('lang') == 'ar' else 'Your cart is empty. ' }}`} <a href="/products">${`{{ 'ØªØµÙØ­ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª' if session.get('lang') == 'ar' else 'Browse products' }}`}</a></p>`;
        totalDiv.textContent = '';
        checkoutBtn.style.display = 'none';
    } else {
        let html = '<ul>';
        cart.forEach((item, i) => {
            html += `<li>${`{{ 'Ù„.Ø³' if session.get('lang') == 'ar' else '$' }}`}${item.price.toFixed(2)} - ${item.name}
                     <button class="remove-btn" data-index="${i}" style="margin-{{ 'right' if session.get('lang') == 'ar' else 'left' }}:10px; color:#e74c3c;">${`{{ 'Ø¥Ø²Ø§Ù„Ø©' if session.get('lang') == 'ar' else 'Remove' }}`}</button></li>`;
        });
        html += '</ul>';
        itemsDiv.innerHTML = html;
        const total = cart.reduce((sum, item) => sum + item.price, 0);
        totalDiv.textContent = `${`{{ 'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ' if session.get('lang') == 'ar' else 'Total: ' }}`}${`{{ 'Ù„.Ø³' if session.get('lang') == 'ar' else '$' }}`}${total.toFixed(2)}`;
        checkoutBtn.style.display = 'block';

        document.querySelectorAll('.remove-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const index = btn.dataset.index;
                cart.splice(index, 1);
                localStorage.setItem('healthband-cart', JSON.stringify(cart));
                updateCart();
            });
        });
    }
}

document.getElementById('checkout-btn')?.addEventListener('click', () => {
    alert(`${`{{ 'âœ… ØªÙ… ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø·Ù„Ø¨! (ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙˆØ¶ÙŠØ­ÙŠ)' if session.get('lang') == 'ar' else 'âœ… Order placed! (Demo mode)' }}`}`);
    localStorage.removeItem('healthband-cart');
    updateCart();
});

updateCart();
</script>
{% endblock %}